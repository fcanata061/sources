#!/usr/bin/env python3
"""
CLI principal do gerenciador de pacotes Source.
Este é o entry point que inicializa a interface de linha de comando.
"""

import sys
import os
import traceback

# ===== Corrigir caminho dos módulos =====
BASE_DIR = os.path.abspath(os.path.dirname(__file__))
MODULES_PATH = os.path.join(BASE_DIR, "modules")

if MODULES_PATH not in sys.path:
    sys.path.insert(0, MODULES_PATH)

# ===== Imports principais =====
try:
    from modules import cli
    # Alias para compatibilidade
    SourceCLI = getattr(cli, "SourceCLI", getattr(cli, "CLI"))
except ImportError as e:
    print(f"[ERRO] Falha ao importar CLI: {e}")
    sys.exit(1)

# Utils é opcional
try:
    from modules.utils import Utils
except ImportError:
    Utils = None

# ===== Função principal =====
def main():
    try:
        cli_instance = SourceCLI()
        cli_instance.run()
    except KeyboardInterrupt:
        from rich.console import Console
        Console().print("\n[red]❌ Execução interrompida pelo usuário[/red]")
        sys.exit(130)
    except Exception as e:
        from rich.console import Console
        console = Console()
        if "--debug" in sys.argv:
            console.print_exception()
        else:
            console.print(f"[bold red]❌ Erro fatal:[/bold red] {e}")
            console.print("Use [yellow]--debug[/yellow] para ver detalhes.")
        sys.exit(1)


if __name__ == "__main__":
    main()
